{% extends "base.html" %} {% block title %}Browse Donations - Food Wastage
Reduction App{% endblock %} {% block content %}
<div class="container-fluid">
  <div class="row">
    <!-- Filters Sidebar -->
    <div class="col-md-3 col-lg-2">
      <div class="card mt-4">
        <div class="card-header">
          <h5 class="mb-0"><i class="bi bi-funnel"></i> Filters</h5>
        </div>
        <div class="card-body">
          <form method="GET">
            <div class="mb-3">
              <label class="form-label">Availability</label>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  name="available"
                  value="true"
                  {%
                  if
                  filter_available
                  %}checked{%
                  endif
                  %}
                />
                <label class="form-check-label"> Available Now Only </label>
              </div>
            </div>

            <div class="mb-3">
              <label for="location" class="form-label">Location</label>
              <input
                type="text"
                class="form-control form-control-sm"
                name="location"
                value="{{ location_filter }}"
                placeholder="Enter area/city"
              />
            </div>

            <button type="submit" class="btn btn-success btn-sm w-100">
              <i class="bi bi-search"></i> Apply Filters
            </button>

            {% if filter_available or location_filter %}
            <a
              href="{{ url_for('donations.list_donations') }}"
              class="btn btn-outline-secondary btn-sm w-100 mt-2"
            >
              <i class="bi bi-x"></i> Clear Filters
            </a>
            {% endif %}
          </form>
        </div>
      </div>
    </div>

    <!-- Donations List -->
    <div class="col-md-9 col-lg-10">
      <div class="mt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2>
            <i class="bi bi-list"></i> Available Donations {% if donations.total
            > 0 %}
            <small class="text-muted">({{ donations.total }} found)</small>
            {% endif %}
          </h2>
        </div>

        {% if donations.items %}
        <div class="row">
          {% for donation in donations.items %}
          <div class="col-lg-4 col-md-6 mb-4">
            <div
              class="card card-hover h-100 {% if not donation.is_available() %}opacity-75{% endif %}"
            >
              {% if donation.image_path %}
              <img
                src="{{ url_for('static', filename='uploads/' + donation.image_path) }}"
                class="card-img-top"
                style="height: 200px; object-fit: cover"
                alt="{{ donation.title }}"
              />
              {% else %}
              <img
                src="https://images.pexels.com/photos/1640774/pexels-photo-1640774.jpeg?auto=compress&cs=tinysrgb&w=300"
                class="card-img-top"
                style="height: 200px; object-fit: cover"
                alt="Food donation"
              />
              {% endif %}

              <div class="card-body d-flex flex-column">
                <h5 class="card-title">{{ donation.title }}</h5>
                <p class="card-text">
                  {{ donation.description[:120] }}{% if
                  donation.description|length > 120 %}...{% endif %}
                </p>

                <div class="mb-2">
                  <small class="text-muted">
                    <i class="bi bi-shop"></i> {{ donation.restaurant.name }} </small
                  ><br />
                  <small class="text-muted">
                    <i class="bi bi-geo-alt"></i> {{ donation.address }}
                  </small>
                </div>

                <div class="mt-auto">
                  <div class="mb-2">
                    <span class="badge bg-primary"
                      >{{ donation.food_type }}</span
                    >
                    <span class="badge bg-info">{{ donation.quantity }}</span>
                    {% if donation.status == 'claimed' %}
                    <span class="badge bg-warning">Claimed</span>
                    {% elif not donation.is_available() %}
                    <span class="badge bg-danger">Expired</span>
                    {% else %}
                    <span class="badge bg-success">Available</span>
                    {% endif %}
                  </div>

                  <div class="text-muted time-left mb-2">
                    <i class="bi bi-clock"></i> {{ donation|time_left }}
                  </div>

                  <a
                    href="{{ url_for('donations.detail', id=donation.id) }}"
                    class="btn btn-outline-success btn-sm w-100"
                  >
                    <i class="bi bi-eye"></i> View Details
                  </a>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>

        <!-- Pagination -->
        {% if donations.pages > 1 %}
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center">
            {% if donations.has_prev %}
            <li class="page-item">
              <a
                class="page-link"
                href="{{ url_for('donations.list_donations', page=donations.prev_num, available=filter_available, location=location_filter) }}"
              >
                Previous
              </a>
            </li>
            {% endif %} {% for page_num in donations.iter_pages() %} {% if
            page_num %} {% if page_num != donations.page %}
            <li class="page-item">
              <a
                class="page-link"
                href="{{ url_for('donations.list_donations', page=page_num, available=filter_available, location=location_filter) }}"
              >
                {{ page_num }}
              </a>
            </li>
            {% else %}
            <li class="page-item active">
              <span class="page-link">{{ page_num }}</span>
            </li>
            {% endif %} {% else %}
            <li class="page-item disabled">
              <span class="page-link">...</span>
            </li>
            {% endif %} {% endfor %} {% if donations.has_next %}
            <li class="page-item">
              <a
                class="page-link"
                href="{{ url_for('donations.list_donations', page=donations.next_num, available=filter_available, location=location_filter) }}"
              >
                Next
              </a>
            </li>
            {% endif %}
          </ul>
        </nav>
        {% endif %} {% else %}
        <div class="text-center py-5">
          <i class="bi bi-inbox display-1 text-muted"></i>
          <h4 class="mt-3">No donations found</h4>
          <p class="text-muted">
            {% if filter_available or location_filter %} Try adjusting your
            filters or
            <a href="{{ url_for('donations.list_donations') }}"
              >view all donations</a
            >. {% else %} Check back later for new food donations. {% endif %}
          </p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
